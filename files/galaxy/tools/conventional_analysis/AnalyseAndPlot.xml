<tool id="analyseAndPlot" name="Analyse and Plot">
  <description></description>                                                           
  <requirements>                                                                                                  
	  <requirement type="package" version="1.0.0">dataanalysis</requirement>
  </requirements>
  <command>
    <![CDATA[
	     #set $arg2 = '0'	  
	     #if str($arg1) == '1':
	     #set $arg2 = '0'
	     #else
	     #set $arg2 = '1'
	     #end if
	     #if str($arg1) =='2':
	     #set $arg1='1' 
	     #set $arg2 = '1'	     
	     #end if

	     #set $inputruncard=''
	     #for $s in $runcards
             #set $inputruncard = $s.runcard
	     echo "Runcard File :"'$inputruncard.element_identifier';
	     #end for

	     
	     python '/storage/shared/software/Scripts/ATLASOpenData/13TeV/GenericRunSelector.py'
	     #if $file['filetype'] == "default":
	     '--dataset=$dataset' '--doData=$arg1' '--doMC=$arg2' ;
	     #elif $inputruncard:
	     '--dataset=$dataset' '--doData=$arg1' '--doMC=$arg2' '--runcard=$inputruncard.element_identifier' ;
	     
	     #elif $file['filetype'] == "upload":
	    
	     #if not $inputruncard: 
	     '--header=$h_file' '--source=$c_file' '--dataset=$dataset' '--doData=$arg1' '--doMC=$arg2';
	     #elif $inputruncard:
             '--header=$h_file' '--source=$c_file' '--dataset=$dataset' '--doData=$arg1' '--doMC=$arg2' '--runcard=$inputruncard.element_identifier';
	     #end if 
	     #end if
	     ]]>

</command>
<inputs>
	 <conditional name="file">
            <param name="filetype" type="select" label="choose which header and source file to use">
                <option value="default" selected="true">Use Default files</option>
                <option value="upload">Upload the files</option>
            </param>
            <when value="upload">
<param name="h_file" type="data" format="source.h" label="MySelector.h " title="InputFiles" help="Please select MySelector.h from the dropdown or upload new MySelector.h from the 'Browse Datasets' button to the right." visible="false"/>
<param name="c_file" type="data"  format="source.c" label="MySelector.C " help="Pease select MySelector.C from the dropdown or upload new MySelector.C from the 'Browse Datasets' button to the right." visible="false" />
	</when>
</conditional>
<param name="dataset" type="select" label="Please select the skim" help="If no option has selected the first one is selected by default.">
  <option value="1largeRjet1lep">1largeRjet1lep</option>
  <option value="1lep">1lep</option>
  <option value="1lep1tau">1lep1tau</option>
  <option value="2lep">2lep</option>
  <option value="3lep" selected="true">3lep</option>
  <option value="4lep">4lep</option>
  <option value="exactly2lep">exactly2lep</option>
  <option value="GamGam">GamGam</option>
</param>
<param name="arg1" type="select" label="Select Specific for above selection" help="If no option has selected the first one is selected by default.">
  <option value="1" selected="true">Data</option>
  <option value="0">MC</option>
  <option value="2">Data and MC</option>
</param>
    <repeat name="runcards" title="Runcard"  ext="txt" format="txt" max="1">
          <param name="runcard" type="data" format="txt" ext="txt" labe="runcard"  title="runcard" help="Please select runCard" />
    </repeat>
</inputs>
<outputs>
  <collection name="output1" type="list"  label="ATLASOpenData Data Hist">
    <discover_datasets pattern="(?P&lt;designation&gt;.+.*Data\..*)\.root" directory="Histograms/"  ext="hep.data.root"  recurse="true" >
      <filter>arg1 in ["1", "2"] </filter>
    </discover_datasets>

  </collection>

  <collection name="output2" type="list"  label="ATLASOpenData MC Hists">
    <discover_datasets pattern="(?P&lt;designation&gt;.+.*MC.*)\.root" directory="Histograms/"   ext="hep.mc.root" recurse="true"  />
        <filter>arg1 in  ["0", "2"] </filter>
  </collection>

  <collection name="output3" type="list"  label="ATLASOpenData Plots">
    <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" directory="Histograms/"  ext="png" recurse="true"  />
  </collection>
</outputs>
</tool>


